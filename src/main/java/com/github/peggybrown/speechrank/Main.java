package com.github.peggybrown.speechrank;import com.github.peggybrown.speechrank.entities.*;import javaslang.collection.List;import ratpack.server.RatpackServer;import java.util.stream.Collectors;import static ratpack.jackson.Jackson.json;public class Main {    private static Storage storage;    public static void main(String... args) throws Exception {        addFakeConference();        RatpackServer.start(server -> server                .handlers(chain -> chain                        .all(new CORSHandler())                        .post("rating", ctx ->                                ctx.parse(Rate.class).then(rate -> {                                    storage.add(rate);                                    ctx.render("OK");                                }))                        .post("comment", ctx ->                                ctx.parse(Comment.class).then(comment -> {                                    storage.add(comment);                                    ctx.render("OK");                                }))                        .get(ctx -> ctx.render(options))                        .get("conferences", ctx -> ctx.render(json(storage.getYears())))                        .get("conference/:id", ctx -> {                            ctx.render(json(storage.getConference(ctx.getPathTokens().get("id"))));                        })));    }    private static void addFakeConference() {        storage = new Storage();        storage.addYear("2016");        storage.addYear("2015");        storage.addYear("2014");        java.util.List<Presentation>prezi1  = new Importer().importConfitura2015()                .stream().map(Presentation::new).collect(Collectors.toList());        Conference conf15 = new Conference("12", "Confitura", List.ofAll(prezi1));        Conference conf16 = new Conference("13", "Devoxx", List.empty());        storage.add("2015", conf15);;        storage.add("2016", conf16);    }    private static String options =            "GET /conferences\n" +                    "GET /conference/:id\n" +                    "POST /rating\n" +                    "POST /comment\n";}
