package com.github.peggybrown.speechrank;import com.github.peggybrown.speechrank.entities.*;import javaslang.collection.List;import ratpack.server.RatpackServer;import static ratpack.jackson.Jackson.json;public class Main {    private static Storage storage;    public static void main(String... args) throws Exception {        addFakeConference();        RatpackServer.start(server -> server                .handlers(chain -> chain                        .all(new CORSHandler())                        .post("rating", ctx ->                                ctx.parse(Rate.class).then(rate -> {                                    storage.add(rate);                                    ctx.render("OK");                                }))                        .post("comment", ctx ->                                ctx.parse(Comment.class).then(comment -> {                                    storage.add(comment);                                    ctx.render("OK");                                }))                        .get(ctx -> ctx.render(options))                        .get("conferences", ctx -> ctx.render(json(storage.getYears())))                        .get("conference/:id", ctx -> {                            ctx.render(json(storage.getConference(ctx.getPathTokens().get("id"))));                        })));    }    private static void addFakeConference() {        storage = new Storage();        storage.addYear("2016");        storage.addYear("2015");        storage.addYear("2014");        Presentation prez1 = new Presentation("1", "title1", "https://youtube/embeded/pnzZFwUGtsk", 0.0, List.empty(), List.empty());        Presentation prez2 = new Presentation("2", "title2", "https://youtube/embeded/pHT1OWIsCbY", 0.0, List.empty(), List.empty());        Presentation prez3 = new Presentation("3", "title3", "https://youtube/embeded/qP2A6DODr98", 0.0, List.empty(), List.empty());        Conference conf14 = new Conference("12", "Confitura", List.of(prez1));        Conference conf15 = new Conference("11", "Geecon", List.of(prez3));        Conference conf16 = new Conference("12", "Devoxx", List.of(prez2));        storage.add("2014",conf14);        storage.add("2015",conf15);        storage.add("2016",conf16);    }    private static String options =            "GET /conferences\n" +                    "GET /conference/:id\n" +                    "POST /rating\n" +                    "POST /comment\n";}
